////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Copyright (c) 2017, 2019 Qualcomm Technologies, Inc.
// All Rights Reserved.
// Confidential and Proprietary - Qualcomm Technologies, Inc.
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// @file  camxifetintlessbgstats15.h
/// @brief Tintless BG Stats V 1.5 class declarations
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
#ifndef CAMXIFETINTLESSBGSTATS15_H
#define CAMXIFETINTLESSBGSTATS15_H

#include "camxispstatsmodule.h"
#include "camxiqinterface.h"

CAMX_NAMESPACE_BEGIN

// Register range from the SWI/HPG
static const UINT32 TintlessBGStats15RegionMinWidth  = 6;   ///< Minimum TintlessBG stats region width that we could configure
static const UINT32 TintlessBGStats15RegionMinHeight = 2;   ///< Minimum TintlessBG stats region Height that we could configure
static const UINT32 TintlessBGStats15RegionMaxWidth  = 390; ///< Minimum TintlessBG stats region width that we could configure
static const UINT32 TintlessBGStats15RegionMaxHeight = 512; ///< Minimum TintlessBG stats region Height that we could configure

static const INT32 TintlessBGStats15MaxHorizontalregions = 64; ///< Maximum TintlessBG stats horizontal region
static const INT32 TintlessBGStats15MaxVerticalregions   = 48;  ///< Maximum TintlessBG stats vertical region

static const UINT32 TintlessBGStats15MaxChannelThreshold = ((1 << IFEPipelineBitWidth) - 1); ///< Max channel threshold

/// @brief TintlessBG configuration data
struct TintlessBG15ConfigData
{
    ISPTintlessBGStatsConfig*   pTintlessBGConfig; ///< TintlessBG configuration data from stats
    UINT32                      regionWidth;       ///< Tintless BG stats ROI region width
    UINT32                      regionHeight;      ///< Tintless BG stats ROI region height
};

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// @brief TintlessBGStats15 Class Implementation
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
class TintlessBGStats15 final : public ISPStatsModule
{
public:
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    /// Create
    ///
    /// @brief  Create TintlessBGStats15 Object
    ///
    /// @param  pCreateData Pointer to the TintlessBGStats15 Creation
    ///
    /// @return CamxResultSuccess if successful.
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    static CamxResult Create(
        IFEStatsModuleCreateData* pCreateData);

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    /// Execute
    ///
    /// @brief  Execute process capture request to configure module
    ///
    /// @param  pInputData Pointer to the ISP input data
    ///
    /// @return CamxResultSuccess if successful.
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    virtual CamxResult Execute(
        ISPInputData* pInputData);

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    /// ~TintlessBGStats15
    ///
    /// @brief  Destructor
    ///
    /// @return None
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    virtual ~TintlessBGStats15();

protected:
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    /// TintlessBGStats15
    ///
    /// @brief  Constructor
    ///
    /// @return None
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    TintlessBGStats15();

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    /// Initialize
    ///
    /// @brief  Initialize parameters
    ///
    /// @param  pCreateData Input data to initialize the module
    ///
    /// @return CamxResultSuccess if successful
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    virtual CamxResult Initialize(
        IFEStatsModuleCreateData* pCreateData);

private:
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    /// ValidateDependenceParams
    ///
    /// @brief  Validate the stats region of interest configuration from stats module
    ///
    /// @param  pInputData Pointer to the ISP input data
    ///
    /// @return CamxResult Indicates if the input is valid or invalid
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    CamxResult ValidateDependenceParams(
        ISPInputData* pInputData) const;

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    /// UpdateIFEInternalData
    ///
    /// @brief  Update TintlessBG configuration to the Internal Data
    ///
    /// @param  pInputData Pointer to the ISP input data
    ///
    /// @return None
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    VOID UpdateIFEInternalData(
        ISPInputData* pInputData) const;

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    /// CheckDependenceChange
    ///
    /// @brief  Check to see if the Dependence Trigger Data Changed
    ///
    /// @param  pInputData Pointer to the ISP input data
    ///
    /// @return BOOL
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    BOOL CheckDependenceChange(
        const ISPInputData* pInputData);

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    /// RunCalculation
    ///
    /// @brief  Calculate the Register Value
    ///
    /// @param  pInputData Pointer to the ISP input data
    ///
    /// @return None
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    VOID RunCalculation(
        ISPInputData* pInputData);

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    /// PrepareStripingParameters
    ///
    /// @brief  Prepare striping parameters for striping lib
    ///
    /// @param  pInputData Pointer to the Inputdata
    ///
    /// @return CamxResultSuccess if successful.
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    virtual CamxResult PrepareStripingParameters(
        ISPInputData* pInputData);

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    /// AdjustROIParams
    ///
    /// @brief  Adjust ROI from stats to requirement based on hardware
    ///
    /// @param  pRegionWidth  pointer to Tintless BG stats ROI region width
    /// @param  pRegionHeight pointer to Tintless BG stats ROI region height
    ///
    /// @return None
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    VOID AdjustROIParams(
        UINT32* pRegionWidth,
        UINT32* pRegionHeight);

    TintlessBGStats15(const TintlessBGStats15&)            = delete;    ///< Disallow the copy constructor
    TintlessBGStats15& operator=(const TintlessBGStats15&) = delete;    ///< Disallow assignment operator

    ISPTintlessBGStatsConfig m_tintlessBGConfig;    ///< TintlessBG configuration data from stats
    TintlessBG15ConfigData   m_inputConfigData;     ///< TintlessBG Configuration data
};

CAMX_NAMESPACE_END

#endif // CAMXIFETINTLESSBGSTATS15_H
